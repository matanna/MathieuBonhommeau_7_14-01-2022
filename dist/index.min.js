(()=>{"use strict";function e(e,t,n,r,i,o,a){try{var c=e[o](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,i)}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var n=function(){function n(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),n.exists?n.instance:(this._path=e,n.exists=!0,n.instance=this,this)}var r,i,o,a;return r=n,i=[{key:"getFullDatas",value:(o=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this._path).then((function(e){if(e.ok)return e.json()})).then((function(e){return e})).catch((function(e){console.log("Un problème est survenu: ".concat(e))})));case 1:case"end":return e.stop()}}),e,this)})),a=function(){var t=this,n=arguments;return new Promise((function(r,i){var a=o.apply(t,n);function c(t){e(a,r,i,c,s,"next",t)}function s(t){e(a,r,i,c,s,"throw",t)}c(void 0)}))},function(){return a.apply(this,arguments)})}],i&&t(r.prototype,i),Object.defineProperty(r,"prototype",{writable:!1}),n}();function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t){var n=t.id,r=t.name,i=t.ingredients,o=t.time,a=t.description,c=t.appliance,s=t.ustensils;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n,this._name=r,this.ingredients=i,this._time=o,this._description=a,this._appliance=c,this._ustensils=s}var t,n;return t=e,(n=[{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"ingredients",get:function(){return this._ingredients},set:function(e){this._ingredients=e}},{key:"time",get:function(){return this._time},set:function(e){this._time=e}},{key:"description",get:function(){return this._description},set:function(e){this._description=e}},{key:"appliance",get:function(){return this._appliance},set:function(e){this._appliance=e}},{key:"ustensils",get:function(){return this._ustensils},set:function(e){this._ustensils=e}}])&&r(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.recipe=t,this.recipeSection=document.querySelector("#recipe-section .row")}var t,n;return t=e,(n=[{key:"build",value:function(){this.recipeSection.append(this.cardDOM())}},{key:"cardDOM",value:function(){var e=document.createElement("div");e.classList.add("col-12","col-md-6","col-xl-4","mb-5");var t='\n                <a href="#" title="Voir cette recette">\n                    <div class="card h-100" aria-labelledby="recipe-title-'.concat(this.recipe.id,'" aria-describedby="recipe-description-').concat(this.recipe.id,'">\n                        <div class="card-image"></div>\n                        <div class="card-header d-flex justify-content-between align-items-center pt-3">\n                            <h2 id="recipe-title-').concat(this.recipe.id,'" class="card-title fw-normal mb-0 w-75">').concat(this.recipe.name,'</h2>\n                            <span class="card-time fw-bold">').concat(this.recipe.time,' min</span>\n                        </div>\n                        <div class="card-body">\n                            <div class="row">\n                                <ul class="col-6 list-unstyled list-group">\n            ');return this.recipe.ingredients.forEach((function(e){t+='\n                    <li class="list-group-item card-list">\n                        '.concat(e.ingredient?'<span class="fw-bold">'+e.ingredient+"</span>":"","\n                        ").concat(e.quantity?": "+e.quantity:"","\n                        ").concat(e.unit?e.unit.replace("grammes","g").replace("cuillères à soupe","cs"):"","</li>\n                ")})),t+='  \n                                </ul>\n                                <div class="col-6">\n                                    <p id="recipe-description-'.concat(this.recipe.id,'" class="card-text text-justify">\n                                        ').concat(this.recipe.description.length>200?this.recipe.description.substr(0,200)+"...":this.recipe.description,"\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </a>\n            "),e.innerHTML=t,e}}])&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"getIngredients",value:function(e){var t=[];return e.forEach((function(e){e.ingredients.forEach((function(e){if(null!==e){var n=e.ingredient[0].toUpperCase()+e.ingredient.slice(1);t.push(n)}}))})),new Set(t)}},{key:"getAppliances",value:function(e){var t=[];return e.forEach((function(e){null!==e&&t.push(e.appliance)})),new Set(t)}},{key:"getUstensils",value:function(e){var t=[];return e.forEach((function(e){e.ustensils.forEach((function(e){if(null!==e){var n=e[0].toUpperCase()+e.slice(1);t.push(n)}}))})),new Set(t)}},{key:"filter",value:function(e,t){for(var n=0,r=e.length-1,i="",o=!0,a=[];o;){var c=e[i=Math.floor((r-n)/2+n)][0].toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");t===c.substring(0,t.length)&&(a.push(e[i]),o=!1),t.localeCompare(c.substring(0,t.length))<0?r=i:t.localeCompare(c.substring(0,t.length))>0&&(n=i),r-n==1&&(o=!1)}for(r=i+1,n=i-1;e[r]&&t===e[r][0].substring(0,t.length);)a.push(e[r]),r++;for(;e[n]&&t===e[n][0].substring(0,t.length);)a.push(e[n]),n--;return a}}],null&&c(t.prototype,null),n&&c(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._arrayItems=t,this.target=n,this.filter=n.dataset.name,this.dropdownMenu=document.createElement("div")}var t,n;return t=e,(n=[{key:"arrayItems",get:function(){return this._arrayItems},set:function(e){this._arrayItems=e}},{key:"build",value:function(){var e=this.target.querySelector(".dropdown-toggle");sessionStorage.setItem("button",this.filter),e.style.display="none",e.setAttribute("aria-expanded",!0),this.dropdownMenu.classList.add("dropdown-list","rounded"),this.dropdownMenu.setAttribute("aria-labelledby","dropdown-".concat(this.filter)),this.dropdownMenu.innerHTML='\n                <div class="row" data-name="'.concat(this.filter,'">\n                    <form action="#" class="dropdown-search" id="search-bar-').concat(this.filter,'">\n                        <label for="search-').concat(this.filter,'" id="title-').concat(this.filter,'" class="form-label d-none">Rechercher un ').concat(this.label(),'</label>\n                        <input type="search" id="search-').concat(this.filter,'" class="form-control py-4 border-0 dropdown-input" placeholder="Rechercher un ').concat(this.label(),'" aria-labelledby="search-bar-').concat(this.filter,'">\n                        <i class="fas fa-chevron-up close-dropdown" role="button"></i>\n                    </form>\n                    <div class="items-content row" aria-label="Liste des ').concat(this.label(),'"></div>\n                </div>\n            '),this.buildItems(),this.target.append(this.dropdownMenu),this.target.classList.replace("close","open")}},{key:"buildItems",value:function(){var e=this.dropdownMenu.querySelector(".items-content");this.arrayItems.forEach((function(t){var n=document.createElement("div");n.classList.add("item","col-12","col-lg-6","col-xl-4","py-1"),n.setAttribute("data-value",t),n.setAttribute("role","option"),n.innerHTML=t,e.append(n)}))}},{key:"label",value:function(){return"ingredients"===this.filter?"ingredient":"appliances"===this.filter?"appareil":"ustensils"===this.filter?"ustensile":void 0}}])&&l(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tag=t,this.list=n}var t,n;return t=e,(n=[{key:"build",value:function(){var e=document.createElement("div");e.classList.add("tag","w-auto","py-2","px-3","rounded"),e.setAttribute("data-value",this.tag),e.setAttribute("data-list",this.list),e.innerHTML="\n                ".concat(this.tag,'\n                <i class="far fa-times-circle close-tag"></i>\n            '),document.querySelector(".tags-location").append(e)}}])&&f(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function p(e){var t=e.target.dataset.value,n=e.target.parentNode.parentElement.dataset.name,r=!1;document.querySelectorAll(".tag").forEach((function(e){t===e.dataset.value&&n===e.dataset.list&&(r=!0)})),!1===r&&(new d(t,n).build(),document.querySelectorAll(".close-tag").forEach((function(e){e.addEventListener("click",h)}))),m(n)}function h(e){e.target.parentElement.remove()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"buildRecipesIndex",value:function(e){var t=e.map((function(e){var t,n="".concat(e.name," ").concat(e.description),r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw o}}}}(e.ingredients);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+=" ".concat(i.ingredient)}}catch(e){r.e(e)}finally{r.f()}return(n=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")).replace(/\b.{0,2}\b/g,",").replace(/[^a-z0-9,]{1}/g,"").split(/,{1,}/g)})),n=new Map;return t.forEach((function(e){e.forEach((function(r){""!==r&&(void 0===n.get(r)?n.set(r,[[t.indexOf(e)+1,1]]):n.get(r)[n.get(r).length-1][0]===t.indexOf(e)+1?n.get(r)[n.get(r).length-1][1]++:n.get(r)[n.get(r).length-1][0]!==t.indexOf(e)+1&&n.get(r).push([t.indexOf(e)+1,1]))}))})),Array.from(n).sort()}},{key:"buildKeywordsIndex",value:function(e){var t=new Map;return e.forEach((function(e,n){e.forEach((function(e){""!==e&&(void 0===t.get(e)?t.set(e,[n]):t.get(e).push(n))}))})),t}}],null&&y(t.prototype,null),n&&y(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function b(e,t){var n=[];"ingredients"===t.dataset.name&&(n=s.getIngredients(e)),"appliances"===t.dataset.name&&(n=s.getAppliances(e)),"ustensils"===t.dataset.name&&(n=s.getUstensils(e));var r=new u(n,t);r.build(),document.querySelector(".close-dropdown").addEventListener("click",(function(e){e.stopPropagation(),m(document.querySelector(".dropdown-list .row").dataset.name)})),document.querySelector(".dropdown-input").addEventListener("keyup",(function(e){var t=e.target.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),i=Array.from(n),o=i.map((function(e){return(e=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")).replace(/\b.{0,2}\b/g,",").replace(/[^a-z0-9,]{1}/g,"").split(/,{1,}/g)})),a=g.buildKeywordsIndex(o);a=Array.from(a).sort();var c=s.filter(a,t).map((function(e){return e.pop()})).flat().map((function(e){return i[e]}));document.querySelector(".items-content").innerHTML="",r.arrayItems=new Set(c),r.buildItems()})),document.querySelectorAll(".items-content").forEach((function(e){e.addEventListener("click",p)}))}function m(e){document.querySelector(".dropdown-list").remove(),sessionStorage.clear();var t=document.querySelector('.dropdown-filters[data-name="'.concat(e,'"] button'));t.style.display="inline-block",t.parentElement.classList.replace("open","close"),t.setAttribute("aria-expanded","false")}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var E=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.needle=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),this.recipes=n,this.index=r}var t,n;return t=e,(n=[{key:"search",value:function(){var e=this,t=performance.now(),n=[],r=[],i=[];if(this.needle.split(" ").forEach((function(t){if(!(t.length<3)){var i=e.find(t);i.length>0?(r.push(i.map((function(e){return e[0]}))),n.push(i)):n=""}})),r.length<1)return[];if(r[0].forEach((function(e){for(var t=0,n=1;n<r.length;n++)r[n].includes(e)&&t++;t===r.length-1&&i.push(e)})),0===i.length&&r.length>1&&(n=""),""!==n){n=n.flat();var o=[];n.forEach((function(e){o=o.concat([e])}));var a=(o=(o=o.sort((function(e,t){return e[0]-t[0]}))).map((function(e){return function(e){if(Array.isArray(e))return w(e)}(t=e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();var t}))).filter((function(e,t,n){if(void 0===n[t-1]||e[0]!==n[t-1][0])return e;n[t-1][1]+=e[1]}));i.length>0&&(a=a.filter((function(e){return i.includes(e[0])})));var c=(a=a.sort((function(e,t){return t[1]-e[1]}))).map((function(t){var n=e.recipes[t[0]-1];return n.level=t[1],n})),s=performance.now()-t;return console.log(s),c}return[]}},{key:"find",value:function(e){for(var t=0,n=this.index.length-1,r="",i=!0,o="";i;)r=Math.floor((n-t)/2+t),e===this.index[r][0].substring(0,e.length)&&(o=this.index[r][1],i=!1),e.localeCompare(this.index[r][0].substring(0,e.length))<0?n=r:e.localeCompare(this.index[r][0].substring(0,e.length))>0&&(t=r),n-t==1&&(i=!1);if(""!==o.length){for(var a=r+1,c=r-1;e===this.index[a][0].substring(0,e.length);)o=o.concat(this.index[a][1]),a++;for(;e===this.index[c][0].substring(0,e.length);)o=o.concat(this.index[c][1]),c--}return o}}])&&k(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var x=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.message=t}var t,n;return t=e,(n=[{key:"build",value:function(){console.log(this.message);var e=document.querySelector(".messages-location"),t=document.createElement("div");t.classList.add("alert","alert-warning","alert-dismissible","fade","show"),t.setAttribute("role","alert"),t.innerHTML="\n                ".concat(this.message,'\n                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n            '),e.append(t)}}])&&S(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var O=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.recipesToFilter=t,this.keyword=n.dataset.value,this.listbox=n.dataset.list}var t,n;return t=e,(n=[{key:"filter",value:function(){var e=this;return"ingredients"===this.listbox?this.recipesToFilter.filter((function(t){return t.ingredients.some((function(t){return t.ingredient.toLowerCase()===e.keyword.toLowerCase()}))})):"appliances"===this.listbox?this.recipesToFilter.filter((function(t){return t.appliance.toLowerCase()===e.keyword.toLowerCase()})):"ustensils"===this.listbox?this.recipesToFilter.filter((function(t){return t.ustensils.some((function(t){return t.toLowerCase()===e.keyword.toLowerCase()}))})):void 0}}])&&L(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function A(e,t,n,r,i,o,a){try{var c=e[o](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,i)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var C=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._datas=new n("./datas/recipes.json")}var t,r,o,c;return t=e,r=[{key:"displayIndex",value:(o=regeneratorRuntime.mark((function e(){var t,n,r,i,o,a,c,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._datas.getFullDatas();case 2:t=e.sent,n="",r="",i=g.buildRecipesIndex(t),this.createRecipes(t),(o=document.querySelector("#search-bar")).addEventListener("focus",(function(){var e=sessionStorage.getItem("button");e&&e.length>0&&m(e)})),a=document.querySelector(".tags-location"),o.addEventListener("keyup",(function(e){a.innerHTML="";var o=e.target.value;for(document.querySelector("#recipe-section .row").innerHTML="";o.length<3;)return n="",void s.createRecipes(t);var c=new E(o,t,i);n=c.search(),r=n,n.length<1?(document.querySelector(".alert")<1&&(new x('Aucune recette ne correspond à votre critère…, vous pouvez chercher "tarte aux pommes", "poisson", etc.').build(),n=t),document.querySelector(".btn-close").addEventListener("click",(function(e){e.target.parentNode.remove()})),s.createRecipes(t)):(document.querySelectorAll(".alert").length>0&&document.querySelector(".alert").remove(),s.createRecipes(n))})),document.querySelectorAll(".dropdown-filters").forEach((function(e){e.addEventListener("click",(function(e){if("button"===e.target.dataset.type){var r=sessionStorage.getItem("button");r&&r.length>0&&m(r);var i=e.target.parentElement;b(""!==n?n:t,i)}}))})),c={childList:!0,subtree:!0},new MutationObserver((function(e){e.forEach((function(e){r||(r=t);var i=n||t,o="";if(e.addedNodes.length>0&&(o=new O(i,e.addedNodes[0]).filter()),e.removedNodes.length>0){var a=document.querySelectorAll(".tag");a.length>0?(i=r,a.forEach((function(e){i=new O(i,e).filter(),o=i})),""===o&&a.forEach((function(e){return e.remove()}))):o=r}document.querySelector("#recipe-section .row").innerHTML="",s.createRecipes(o),n=o}))})).observe(a,c);case 16:case"end":return e.stop()}}),e,this)})),c=function(){var e=this,t=arguments;return new Promise((function(n,r){var i=o.apply(e,t);function a(e){A(i,n,r,a,c,"next",e)}function c(e){A(i,n,r,a,c,"throw",e)}a(void 0)}))},function(){return c.apply(this,arguments)})},{key:"createRecipes",value:function(e){e.forEach((function(e){var t=new i(e);new a(t).build()}))}}],r&&j(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();document.addEventListener("DOMContentLoaded",(function(){return sessionStorage.clear()})),(new C).displayIndex()})();